<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Modern Audio Player</title>
    <style>
        /* ===== –û–°–ù–û–í–ù–´–ï –°–¢–ò–õ–ò –ò –°–ë–†–û–° ===== */
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            display: flex;
            justify-content: center;
            align-items: center;
            padding: 20px;
        }

        /* ===== –ì–õ–ê–í–ù–´–ô –ö–û–ù–¢–ï–ô–ù–ï–† –ü–õ–ï–ï–†–ê ===== */
        .player-container {
            width: 100%;
            max-width: 400px;
            background: rgba(255, 255, 255, 0.95);
            border-radius: 20px;
            box-shadow: 0 20px 40px rgba(0, 0, 0, 0.1);
            overflow: hidden;
        }

        /* ===== –û–ë–õ–ê–°–¢–¨ –° –û–ë–õ–û–ñ–ö–û–ô –ò –û–°–ù–û–í–ù–û–ô –ò–ù–§–û–†–ú–ê–¶–ò–ï–ô ===== */
        .player-main {
            padding: 30px;
            text-align: center;
            /* –¢–ï–ö–°–¢–£–†–ê: –ó–∞–º–µ–Ω–∏—Ç–µ background-image –Ω–∞ —Å–≤–æ—é —Ç–µ–∫—Å—Ç—É—Ä—É */
            background-image: linear-gradient(45deg, #f3f4f6 25%, transparent 25%), 
                              linear-gradient(-45deg, #f3f4f6 25%, transparent 25%), 
                              linear-gradient(45deg, transparent 75%, #f3f4f6 75%), 
                              linear-gradient(-45deg, transparent 75%, #f3f4f6 75%);
            background-size: 20px 20px;
            background-position: 0 0, 0 10px, 10px -10px, -10px 0px;
        }

        .album-art {
            width: 200px;
            height: 200px;
            border-radius: 15px;
            object-fit: cover;
            margin: 0 auto 20px;
            box-shadow: 0 10px 20px rgba(0, 0, 0, 0.2);
        }

        .track-info {
            margin-bottom: 25px;
        }

        .track-title {
            font-size: 24px;
            font-weight: 700;
            color: #2d3748;
            margin-bottom: 5px;
        }

        .track-artist {
            font-size: 16px;
            color: #718096;
            font-weight: 500;
        }

        /* ===== –ü–†–û–ì–†–ï–°–° –ë–ê–† ===== */
        .progress-area {
            margin-bottom: 25px;
        }

        .progress-bar {
            width: 100%;
            height: 6px;
            background: #e2e8f0;
            border-radius: 10px;
            margin-bottom: 8px;
            cursor: pointer;
            position: relative;
        }

        .progress {
            width: 0%;
            height: 100%;
            background: linear-gradient(90deg, #667eea, #764ba2);
            border-radius: 10px;
            transition: width 0.1s linear;
        }

        .timer {
            display: flex;
            justify-content: space-between;
            font-size: 14px;
            color: #718096;
        }

        /* ===== –û–°–ù–û–í–ù–´–ï –ö–ù–û–ü–ö–ò –£–ü–†–ê–í–õ–ï–ù–ò–Ø ===== */
        .controls {
            display: flex;
            justify-content: center;
            align-items: center;
            gap: 20px;
            margin-bottom: 10px;
        }

        .control-btn {
            background: none;
            border: none;
            font-size: 20px;
            color: #667eea;
            cursor: pointer;
            padding: 10px;
            border-radius: 50%;
            transition: all 0.3s ease;
        }

        .control-btn:hover {
            background: rgba(102, 126, 234, 0.1);
            transform: scale(1.1);
        }

        .play-pause {
            width: 60px;
            height: 60px;
            background: linear-gradient(135deg, #667eea, #764ba2);
            color: white;
            font-size: 24px;
            display: flex;
            justify-content: center;
            align-items: center;
            border-radius: 50%;
            box-shadow: 0 5px 15px rgba(102, 126, 234, 0.4);
        }

        .play-pause:hover {
            transform: scale(1.05);
            box-shadow: 0 8px 20px rgba(102, 126, 234, 0.6);
        }

        /* ===== –î–û–ü–û–õ–ù–ò–¢–ï–õ–¨–ù–´–ï –ö–û–ù–¢–†–û–õ–´ ===== */
        .additional-controls {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 0 30px 20px;
        }

        .volume-control {
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .volume-slider {
            width: 100px;
            height: 4px;
            background: #e2e8f0;
            border-radius: 10px;
            cursor: pointer;
        }

        .volume-progress {
            width: 70%;
            height: 100%;
            background: #667eea;
            border-radius: 10px;
        }

        .extra-controls {
            display: flex;
            gap: 15px;
        }

        /* ===== –û–ë–õ–ê–°–¢–¨ –ü–õ–ï–ô–õ–ò–°–¢–ê ===== */
        .playlist-section {
            background: rgba(247, 250, 252, 0.8);
            border-top: 1px solid #e2e8f0;
            padding: 20px 30px;
            max-height: 300px;
            overflow-y: auto;
        }

        .playlist-title {
            font-size: 18px;
            font-weight: 600;
            color: #2d3748;
            margin-bottom: 15px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .shuffle-btn {
            background: none;
            border: none;
            color: #667eea;
            cursor: pointer;
            font-size: 14px;
            padding: 5px 10px;
            border-radius: 15px;
            transition: all 0.3s ease;
        }

        .shuffle-btn:hover {
            background: rgba(102, 126, 234, 0.1);
        }

        .playlist {
            list-style: none;
        }

        .playlist-item {
            display: flex;
            align-items: center;
            padding: 12px 0;
            border-bottom: 1px solid #edf2f7;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .playlist-item:hover {
            background: rgba(102, 126, 234, 0.05);
            padding-left: 10px;
        }

        .playlist-item.active {
            color: #667eea;
            background: rgba(102, 126, 234, 0.1);
            border-left: 3px solid #667eea;
            padding-left: 10px;
        }

        .playlist-item-number {
            width: 30px;
            text-align: center;
            font-size: 14px;
            color: #718096;
        }

        .playlist-item-info {
            flex: 1;
        }

        .playlist-item-title {
            font-weight: 500;
            margin-bottom: 2px;
        }

        .playlist-item-artist {
            font-size: 12px;
            color: #718096;
        }

        .playlist-item-duration {
            font-size: 14px;
            color: #a0aec0;
        }

        /* ===== –°–ö–†–û–õ–õ–ë–ê–† –î–õ–Ø –ü–õ–ï–ô–õ–ò–°–¢–ê ===== */
        .playlist-section::-webkit-scrollbar {
            width: 6px;
        }

        .playlist-section::-webkit-scrollbar-track {
            background: #f1f1f1;
            border-radius: 10px;
        }

        .playlist-section::-webkit-scrollbar-thumb {
            background: #cbd5e0;
            border-radius: 10px;
        }

        .playlist-section::-webkit-scrollbar-thumb:hover {
            background: #a0aec0;
        }
    </style>
</head>
<body>
    <!-- –û–°–ù–û–í–ù–û–ô –ö–û–ù–¢–ï–ô–ù–ï–† –ü–õ–ï–ï–†–ê -->
    <div class="player-container">
        
        <!-- –û–°–ù–û–í–ù–ê–Ø –û–ë–õ–ê–°–¢–¨ –° –û–ë–õ–û–ñ–ö–û–ô –ò –ò–ù–§–û–†–ú–ê–¶–ò–ï–ô -->
        <div class="player-main">
            <!-- –û–±–ª–æ–∂–∫–∞ –∞–ª—å–±–æ–º–∞ - –∑–∞–º–µ–Ω–∏—Ç–µ src –Ω–∞ —Å–≤–æ–µ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ -->
            <img src="https://images.unsplash.com/photo-1493225457124-a3eb161ffa5f?ixlib=rb-4.0.3&ixid=M3wxMjA3fDB8MHxwaG90by1wYWdlfHx8fGVufDB8fHx8fA%3D%3D&auto=format&fit=crop&w=2340&q=80" 
                 alt="Album Art" class="album-art">
            
            <!-- –ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ —Ç–µ–∫—É—â–µ–º —Ç—Ä–µ–∫–µ -->
            <div class="track-info">
                <h1 class="track-title">Glimpse of Us</h1>
                <p class="track-artist">Joji</p>
            </div>
            
            <!-- –ü—Ä–æ–≥—Ä–µ—Å—Å –≤–æ—Å–ø—Ä–æ–∏–∑–≤–µ–¥–µ–Ω–∏—è -->
            <div class="progress-area">
                <div class="progress-bar">
                    <div class="progress"></div>
                </div>
                <div class="timer">
                    <span class="current-time">0:00</span>
                    <span class="total-duration">3:16</span>
                </div>
            </div>
            
            <!-- –û—Å–Ω–æ–≤–Ω—ã–µ –∫–Ω–æ–ø–∫–∏ —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è -->
            <div class="controls">
                <button class="control-btn prev-btn">‚èÆ</button>
                <button class="control-btn play-pause play-btn">‚ñ∂</button>
                <button class="control-btn next-btn">‚è≠</button>
            </div>
        </div>
        
        <!-- –î–û–ü–û–õ–ù–ò–¢–ï–õ–¨–ù–´–ï –ö–û–ù–¢–†–û–õ–´ (–ì–†–û–ú–ö–û–°–¢–¨ –ò –ü–û–í–¢–û–†) -->
        <div class="additional-controls">
            <div class="volume-control">
                <span>üîä</span>
                <div class="volume-slider">
                    <div class="volume-progress"></div>
                </div>
            </div>
            <div class="extra-controls">
                <button class="control-btn repeat-btn">üîÅ</button>
                <button class="control-btn like-btn">‚ù§Ô∏è</button>
            </div>
        </div>
        
        <!-- –û–ë–õ–ê–°–¢–¨ –ü–õ–ï–ô–õ–ò–°–¢–ê -->
        <div class="playlist-section">
            <div class="playlist-title">
                <span>–ú–æ–π –ø–ª–µ–π–ª–∏—Å—Ç</span>
                <button class="shuffle-btn">–ü–µ—Ä–µ–º–µ—à–∞—Ç—å</button>
            </div>
            <ul class="playlist">
                <!-- –≠–ª–µ–º–µ–Ω—Ç—ã –ø–ª–µ–π–ª–∏—Å—Ç–∞ –±—É–¥—É—Ç –¥–æ–±–∞–≤–ª–µ–Ω—ã —á–µ—Ä–µ–∑ JavaScript -->
            </ul>
        </div>
    </div>

    <script>
    // ===== –ü–ï–†–ï–ú–ï–ù–ù–´–ï –î–õ–Ø –≠–õ–ï–ú–ï–ù–¢–û–í –î–û–ú–ê =====
    const audio = new Audio();
    let currentTrackIndex = 0;
    let tracks = []; // –ú–∞—Å—Å–∏–≤ –±—É–¥–µ—Ç –∑–∞–ø–æ–ª–Ω–µ–Ω —Å —Å–µ—Ä–≤–µ—Ä–∞

    // –ü–æ–ª—É—á–∞–µ–º —ç–ª–µ–º–µ–Ω—Ç—ã DOM
    const albumArt = document.querySelector('.album-art');
    const trackTitle = document.querySelector('.track-title');
    const trackArtist = document.querySelector('.track-artist');
    const playBtn = document.querySelector('.play-btn');
    const prevBtn = document.querySelector('.prev-btn');
    const nextBtn = document.querySelector('.next-btn');
    const progressBar = document.querySelector('.progress-bar');
    const progress = document.querySelector('.progress');
    const currentTimeEl = document.querySelector('.current-time');
    const totalDurationEl = document.querySelector('.total-duration');
    const volumeSlider = document.querySelector('.volume-slider');
    const volumeProgress = document.querySelector('.volume-progress');
    const playlistEl = document.querySelector('.playlist');
    const shuffleBtn = document.querySelector('.shuffle-btn');

    // ===== –§–£–ù–ö–¶–ò–Ø –î–õ–Ø –ó–ê–ì–†–£–ó–ö–ò –°–ü–ò–°–ö–ê –¢–†–ï–ö–û–í –° –°–ï–†–í–ï–†–ê =====
    async function loadTracks() {
        try {
            const response = await fetch('/api/tracks');
            if (!response.ok) throw new Error('Network response was not ok');
            
            tracks = await response.json();
            
            if (tracks.length === 0) {
                showMessage('–í –ø–∞–ø–∫–µ music –Ω–µ –Ω–∞–π–¥–µ–Ω–æ –∞—É–¥–∏–æ—Ñ–∞–π–ª–æ–≤');
                return;
            }
            
            // –ó–∞–≥—Ä—É–∂–∞–µ–º –ø–µ—Ä–≤—ã–π —Ç—Ä–µ–∫ –∏ –∑–∞–ø–æ–ª–Ω—è–µ–º –ø–ª–µ–π–ª–∏—Å—Ç
            loadTrack(currentTrackIndex);
            populatePlaylist();
            
        } catch (error) {
            console.error('Error loading tracks:', error);
            showMessage('–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ —Ç—Ä–µ–∫–æ–≤. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ, –∑–∞–ø—É—â–µ–Ω –ª–∏ —Å–µ—Ä–≤–µ—Ä.');
        }
    }

    // ===== –§–£–ù–ö–¶–ò–Ø –î–õ–Ø –ó–ê–ì–†–£–ó–ö–ò –ö–û–ù–ö–†–ï–¢–ù–û–ì–û –¢–†–ï–ö–ê =====
    function loadTrack(index) {
        if (tracks.length === 0) return;
        
        const track = tracks[index];
        trackTitle.textContent = track.title;
        trackArtist.textContent = track.artist;
        albumArt.src = track.cover;
        totalDurationEl.textContent = track.duration;
        
        // –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º –∏—Å—Ç–æ—á–Ω–∏–∫ –∞—É–¥–∏–æ
        audio.src = track.src;
        
        // –°–±—Ä–∞—Å—ã–≤–∞–µ–º –ø—Ä–æ–≥—Ä–µ—Å—Å
        progress.style.width = '0%';
        currentTimeEl.textContent = '0:00';
        
        // –û–±–Ω–æ–≤–ª—è–µ–º –∞–∫—Ç–∏–≤–Ω—ã–π —ç–ª–µ–º–µ–Ω—Ç –≤ –ø–ª–µ–π–ª–∏—Å—Ç–µ
        updateActivePlaylistItem(index);
    }

    // ===== –§–£–ù–ö–¶–ò–Ø –î–õ–Ø –û–ë–ù–û–í–õ–ï–ù–ò–Ø –ê–ö–¢–ò–í–ù–û–ì–û –≠–õ–ï–ú–ï–ù–¢–ê –ü–õ–ï–ô–õ–ò–°–¢–ê =====
    function updateActivePlaylistItem(index) {
        document.querySelectorAll('.playlist-item').forEach(item => {
            item.classList.remove('active');
        });
        
        const items = document.querySelectorAll('.playlist-item');
        if (items[index]) {
            items[index].classList.add('active');
        }
    }

    // ===== –§–£–ù–ö–¶–ò–Ø –î–õ–Ø –í–û–°–ü–†–û–ò–ó–í–ï–î–ï–ù–ò–Ø –ò –ü–ê–£–ó–´ =====
    function playPause() {
        if (tracks.length === 0) return;
        
        if (audio.paused) {
            audio.play().then(() => {
                playBtn.textContent = '‚è∏';
            }).catch(error => {
                console.error('Playback failed:', error);
                showMessage('–û—à–∏–±–∫–∞ –≤–æ—Å–ø—Ä–æ–∏–∑–≤–µ–¥–µ–Ω–∏—è –∞—É–¥–∏–æ');
            });
        } else {
            audio.pause();
            playBtn.textContent = '‚ñ∂';
        }
    }

    // ===== –§–£–ù–ö–¶–ò–Ø –î–õ–Ø –ü–ï–†–ï–ö–õ–Æ–ß–ï–ù–ò–Ø –¢–†–ï–ö–ê =====
    function nextTrack() {
        if (tracks.length === 0) return;
        
        currentTrackIndex = (currentTrackIndex + 1) % tracks.length;
        loadTrack(currentTrackIndex);
        audio.play().then(() => {
            playBtn.textContent = '‚è∏';
        });
    }

    function prevTrack() {
        if (tracks.length === 0) return;
        
        currentTrackIndex = (currentTrackIndex - 1 + tracks.length) % tracks.length;
        loadTrack(currentTrackIndex);
        audio.play().then(() => {
            playBtn.textContent = '‚è∏';
        });
    }

    // ===== –§–£–ù–ö–¶–ò–Ø –î–õ–Ø –û–ë–ù–û–í–õ–ï–ù–ò–Ø –ü–†–û–ì–†–ï–°–°–ê =====
    function updateProgress(e) {
        const { duration, currentTime } = e.srcElement;
        if (duration) {
            const progressPercent = (currentTime / duration) * 100;
            progress.style.width = `${progressPercent}%`;
            
            // –û–±–Ω–æ–≤–ª—è–µ–º –≤—Ä–µ–º—è
            const currentMinutes = Math.floor(currentTime / 60);
            const currentSeconds = Math.floor(currentTime % 60);
            currentTimeEl.textContent = `${currentMinutes}:${currentSeconds < 10 ? '0' : ''}${currentSeconds}`;
            
            // –û–±–Ω–æ–≤–ª—è–µ–º –æ–±—â–µ–µ –≤—Ä–µ–º—è –ø—Ä–∏ –ø–µ—Ä–≤–æ–π –∑–∞–≥—Ä—É–∑–∫–µ
            if (totalDurationEl.textContent === '0:00' && !isNaN(duration)) {
                const totalMinutes = Math.floor(duration / 60);
                const totalSeconds = Math.floor(duration % 60);
                totalDurationEl.textContent = `${totalMinutes}:${totalSeconds < 10 ? '0' : ''}${totalSeconds}`;
            }
        }
    }

    // ===== –§–£–ù–ö–¶–ò–Ø –î–õ–Ø –£–°–¢–ê–ù–û–í–ö–ò –ü–†–û–ì–†–ï–°–°–ê –ü–†–ò –ö–õ–ò–ö–ï =====
    function setProgress(e) {
        if (tracks.length === 0) return;
        
        const width = this.clientWidth;
        const clickX = e.offsetX;
        const duration = audio.duration;
        
        if (duration) {
            audio.currentTime = (clickX / width) * duration;
        }
    }

    // ===== –§–£–ù–ö–¶–ò–Ø –î–õ–Ø –£–ü–†–ê–í–õ–ï–ù–ò–Ø –ì–†–û–ú–ö–û–°–¢–¨–Æ =====
    function setVolume(e) {
        const width = this.clientWidth;
        const clickX = e.offsetX;
        const volume = clickX / width;
        
        audio.volume = volume;
        volumeProgress.style.width = `${volume * 100}%`;
    }

    // ===== –§–£–ù–ö–¶–ò–Ø –î–õ–Ø –ó–ê–ü–û–õ–ù–ï–ù–ò–Ø –ü–õ–ï–ô–õ–ò–°–¢–ê =====
    function populatePlaylist() {
        playlistEl.innerHTML = '';
        
        tracks.forEach((track, index) => {
            const li = document.createElement('li');
            li.className = `playlist-item ${index === currentTrackIndex ? 'active' : ''}`;
            li.innerHTML = `
                <div class="playlist-item-number">${index + 1}</div>
                <div class="playlist-item-info">
                    <div class="playlist-item-title">${track.title}</div>
                    <div class="playlist-item-artist">${track.artist}</div>
                </div>
                <div class="playlist-item-duration">${track.duration}</div>
            `;
            
            li.addEventListener('click', () => {
                currentTrackIndex = index;
                loadTrack(currentTrackIndex);
                audio.play().then(() => {
                    playBtn.textContent = '‚è∏';
                });
            });
            
            playlistEl.appendChild(li);
        });
    }

    // ===== –§–£–ù–ö–¶–ò–Ø –î–õ–Ø –ü–ï–†–ï–ú–ï–®–ò–í–ê–ù–ò–Ø –ü–õ–ï–ô–õ–ò–°–¢–ê =====
    function shufflePlaylist() {
        for (let i = tracks.length - 1; i > 0; i--) {
            const j = Math.floor(Math.random() * (i + 1));
            [tracks[i], tracks[j]] = [tracks[j], tracks[i]];
        }
        populatePlaylist();
        currentTrackIndex = 0;
        loadTrack(currentTrackIndex);
    }

    // ===== –§–£–ù–ö–¶–ò–Ø –î–õ–Ø –û–¢–û–ë–†–ê–ñ–ï–ù–ò–Ø –°–û–û–ë–©–ï–ù–ò–ô =====
    function showMessage(message) {
        // –°–æ–∑–¥–∞–µ–º –∏–ª–∏ –Ω–∞—Ö–æ–¥–∏–º —ç–ª–µ–º–µ–Ω—Ç –¥–ª—è —Å–æ–æ–±—â–µ–Ω–∏–π
        let messageEl = document.querySelector('.message');
        if (!messageEl) {
            messageEl = document.createElement('div');
            messageEl.className = 'message';
            messageEl.style.cssText = `
                position: fixed;
                top: 20px;
                left: 50%;
                transform: translateX(-50%);
                background: #ff6b6b;
                color: white;
                padding: 10px 20px;
                border-radius: 5px;
                z-index: 1000;
            `;
            document.body.appendChild(messageEl);
        }
        
        messageEl.textContent = message;
        messageEl.style.display = 'block';
        
        setTimeout(() => {
            messageEl.style.display = 'none';
        }, 5000);
    }

    // ===== –ù–ê–°–¢–†–û–ô–ö–ê –û–ë–†–ê–ë–û–¢–ß–ò–ö–û–í –°–û–ë–´–¢–ò–ô =====
    playBtn.addEventListener('click', playPause);
    nextBtn.addEventListener('click', nextTrack);
    prevBtn.addEventListener('click', prevTrack);
    
    audio.addEventListener('timeupdate', updateProgress);
    progressBar.addEventListener('click', setProgress);
    
    audio.addEventListener('ended', nextTrack);
    
    volumeSlider.addEventListener('click', setVolume);
    shuffleBtn.addEventListener('click', shufflePlaylist);

    // ===== –ò–ù–ò–¶–ò–ê–õ–ò–ó–ê–¶–ò–Ø –ü–õ–ï–ï–†–ê =====
    // –ó–∞–≥—Ä—É–∂–∞–µ–º —Ç—Ä–µ–∫–∏ —Å —Å–µ—Ä–≤–µ—Ä–∞ –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ —Å—Ç—Ä–∞–Ω–∏—Ü—ã
    loadTracks();
</script>
</body>
</html>
